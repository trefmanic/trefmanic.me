---
published: false
layout: post
title: Установка сервера 1C и PostgreSQL с нуля
date: 2017-10-24 15:35:29 +0500
categories: [справочная] 
tags: [ubuntu,1c,postgresql]
description: Установка на голое железо менеджера VM Proxmox и развёртывание виртуальной машины для сервера 1С
---

Пошаговая инструкция по установке менеждера VM Proxmox и развёртывания в нём контейнера с сервером 1С Предприятие.

### Оборудование ###

![Тестовая картинка][image.jpg]
 
В наличии имелась машина на базе Intel Core i5-3330, оснащённая 8 Gb памяти, двумя Seagate Constellation ES по 2 Tb и SSD на 60 Gb в качестве загрузочного носителя. Решили сделать из неё тестовый полигон для обкатки конфигураций 1С. Большая нагрузка не планируется, зато нужно оперативно разворачивать разные конфигурации серверных ОС. Вследствие этого [Proxmox][1] — идеальный выбор.

> Proxmox - менеджер виртуализации, поддерживающий как контейнеры LXC, так и паравиртуализацию при помощи KVM

Пользоваться этой системой можно бесплатно, а можно и оформить платные подписки. Подробнее — на официальном сайте.

### Подготовка ###

Загружаем дистрибутив [Proxmox версии 5.0][2]. Так как на сервере не установлен привод оптических дисков, используем флешку. Подключаем её к компьютеру, используем команду *dd* для создания установочного носителя:

    # dd if=~/proxmox-ve_5.0-5ab26bc-5.iso of=/dev/sdX bs=1M

 где *sdX* — имя диска вашей флешки. Проверить его можно при помощи множества самых разнообразных инструментов, например, **gparted**. Неосторожное отношение к *dd* может привести к **потере ваших данных**, поэтому проверяйте дважды. Чтобы видеть прогресс выполнения удобно использовать следующую команду (запускать после запуска dd):

    # watch -n 5 kill -USR1 $(pgrep -x -u root dd)

После окончания копирования извлеките флешку и загрузитесь с неё. Процесс установки тривиален — потребуется ввести устройство, на которое будет развёрнута система (в нашем случае — на SSD), пароль root и настройки сети. Для примера в дальнейшем я буду использовать адрес *192.168.10.111* в качестве адреса гипервизора. После завершения установки и перезагрузки система готова к работе. 

Для доступа к веб-интерфейсу перейдите на **[https://192.168.10.111:8006][3]**. Также есть доступ по ssh: **root@192.168.10.111**.

Чтобы при запуске веб-интерфейса не появлялось раздражающее предложение оформить платную подписку, подключитесь к гипервизору по ssh и используйте команды, [опубликованные на сайте sysorchestra.com][4] пользователем **janus57**:

    # Проверено на версии proxmox 5.0-30
    sed -i.bak "s/data.status !== 'Active'/false/g" /usr/share/pve-manager/js/pvemanagerlib.js && \
    sed -i.bak "s/data.status !== 'Active'/false/g" /usr/share/pve-manager/touch/pvemanager-mobile.js

### Установка сертификата SSL ###

Для более безопасной работы по 


### Создание ФС ###

Для хранения данных в Proxmox используются т.н. "хранилища" (кто бы мог подумать :). Минус Proxmox VE — отсутствует возможность установки на программный RAID. К счастью, поддерживается файловая система ZFS. В нашем примере (2 HDD) мы создадим пул ZFS с зеркалированием, т.е. аналог RAID 1. Подробнее про файловую систему ZFS можно [прочитать на xgu.ru][5].

Подключаемся к Proxmox VE по ssh или открываем консоль в веб-интерфейсе:

    cd /dev/disk/by-id/
zpool create nuclear mirror /dev/sda1 /dev/sdb1
zpool status -v
zpool list
root@architect:~# zfs create nuclear/templates
root@architect:~# zfs create nuclear/storage
root@architect:~# zfs set compression=on nuclear/templates
root@architect:~# zfs set compression=on nuclear/storage

http://xgu.ru/wiki/ZFS

### Настройка пользователей и прав ###

https://pve.proxmox.com/wiki/User_Management

### Создание контейнеров ###

### --- ###

[1]: https://www.proxmox.com/en/ "Веб-страница проекта Proxmxox"
[2]: https://www.proxmox.com/en/downloads/item/proxmox-ve-5-0-iso-installer "Скачать образ установочного диска Proxmox VE 5.0"
[3]: https://192.168.10.111:8006
[4]: http://disq.us/p/1gigzwk "Ссылка на комментарий janus57 на sysorchestra.com"
[5]: http://xgu.ru/wiki/ZFS "Подробная статья о ZFS на xgu.ru"


[image.jpg]: /files/image.jpg  "Тут Брона возвращается )"
