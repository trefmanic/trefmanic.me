---
published: false
layout: post
title: Настраиваем NAS Synology DS216 как первичный контроллер домена Windows
date: 2016-12-07 09:11:00 +0500
categories: [help] 
tags: [synology, pdc, samba]
description: Настройка NAS Synology как первичного контроллера домена на примере DS 216
---

В этой статье я расскажу, как настроить сетевой накопитель Synology в качестве первичного контроллера домена Windows.

### Предисловие ###

Сетевые накопители Synology - просто кладезь различных возможностей. Есть среди них и не особо документируемые. Так как ОС DSM построена на основе Linux, её возможно модифицировать в крайне широких пределах. Я покажу, как настроить на DS 216 первичный контроллер домена, используя Samba и LDAP в качестве бэкэнда.

### Установка DSM ###

Первым делом необходимо установить в ваш сетевой накопитель жёсткие диски. Подключите питание и сеть. Для дальнейшей установки необходимо, чтобы наша DS получила IP-адрес с сервера DHCP. Для быстрого поиска новых устройст DS и установки ПО рекомендую установить Synology Assistant (есть версия для Linux) с [сайта Synology] [1]. Ссылка дана на пакеты для DS 216. Там же загрузите свежую версию DSM, на момент написания статьи - DSM 6.0.2-8451.

Установите Synology Assistant и запустите его. После непродолжительного поиска в списке должен отобразиться ваш накопитель. Кликните на строку с именем NAS правой кнопкой мыши и выберите "Install DSM", затем укажите путь к загруженному пакету с ОС (расширение .pat). Также вам потребуется указать имя хоста и пароль пользователя admin, после чего некоторое время подождать. Выпейте кофе, например.


### Установка Entware ###

[Entware-NG] [2] это форк optware, репозитария пакетов с дополнительным ПО для интегрированных устройств. Из него нам понадобится несколько пакетов.

После установки ОС и перезагрузки NAS, вы можете попасть в веб-интерфейс по адресу: http://<IP вашего NAS>:5000. Войдите в систему, используя логин **admin** и введённый на предыдущем шаге пароль. Создайте том для хранения данных, используя апплет **"Storage Manager"**. Выбор типа тома и уровня RAID не является частью данного руководства. После создания тома, активируйте доступ по SSH через апплет "Панель управления" (Control Panel -> Advanced mode -> Terminal & SNMP). 

Подключитесь к накопителю по SSH, используя ваш любимый клиент. Для установки репозитария Entware, вам необходимо выполнить следующие команды (источник - [руководство по установке Entware] [3]):

    sudo su
    mkdir -p /volume1/@entware-ng/opt

> Дальнейший шаг удалит каталог **/opt** вместе во всем его содержимым с вашего NAS. Если это свежая установка, можете игнорировать данное предупреждение

    rm -rf /opt
    ln -sf /volume1/@entware-ng/opt /opt
    cd /opt

Загружаем версию для вашего процессора (в DS 216 используется Marvell Armada 285, архитекрура ARMv7)

    wget -O - http://pkg.entware.net/binaries/armv7/installer/entware_install.sh | /bin/sh

После загрузки вам необходимо модифицировать некоторые системные файлы. 



[1]: https://www.synology.com/en-us/support/download/DS216 "Пакеты для Synology DS 216"
[2]: https://github.com/Entware-ng "Центр Entware-ng на гитхабе"
[3]: https://github.com/Entware-ng/Entware-ng/wiki/Install-on-Synology-NAS "Установка Entware-NG"