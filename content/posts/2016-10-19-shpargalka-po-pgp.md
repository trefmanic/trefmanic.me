---
published: true
layout: post
title: Шпаргалка по основным функциям PGP/GnuPG
date: 2016-10-19 16:17:37 +0500
updated: false
tags: [pgp, manual]
description: "В статье приведены примеры использования **gpg2** для управления ключами, подписи и зашифровки/расшифровки сообщений и файлов, пригодные для копипасты."
---

### Управление ключами ###

>man [gpg2][1]

Создание новой пары ключей, интерактивный режим. Необходимо будет указать тип ключа, полное имя и адрес электронной почты, последние *не обязательно должны соответствовать вашим реальным данным*. Также нужно будет указать длину ключа и срок действия. В конце будет запрошен пароль для защиты приватного ключа, рекомендуется его не забывать. 
```bash
    gpg2 --gen-key
```
После ввода всех параметров необходимо будет подождать, пока утилита генерирует случайные числа на основе пользовательского ввода и обращения к дискам. Пару ключей можно также создать в пакетном режиме, подробнее [в документации GnuPG][2]. Ключи хранятся в связке ключей (в Linux это *~/.gnupg/secring.pgp* и *~/.gnupg/pubring.pgp*).

Для отображения списка публичных ключей:
```bash
    gpg2 --list-keys
```
Для приватных ключей:
```bash
    gpg2 --list-secret-keys
```
Образец вывода команды:
```bash
    /home/trefmanic/.gnupg/pubring.gpg
    ----------------------------------
    pub   2048R/609BFCDA 2016-10-19
    uid                  testkey (TEST) <testkey@nonexistent.domain>
    sub   2048R/0884F56E 2016-10-19
```
Виден идентификатор пары ключей (**609BFCDA**), который можно использовать в качестве аргумента опции *-r*.

### Зашифровка, расшифровка и подпись ###

Для того, чтобы зашифровать файл *plaintext.txt* публичным ключом получателя testkey, три варианта:
```bash
    gpg2 -e -r testkey plaintext.txt
    gpg2 -e -r testkey@nonexistent.domain plaintext.txt
    gpg2 -e -r 609BFCDA
```
По умолчанию создаётся бинарный файл *plaintext.txt.pgp*. Для создания ASCII-файла, пригодного к копированию/вставке, используйте опцию *-a*:
```bash
    gpg2 -e -a -r testkey@nonexistent.domain plaintext.txt
```
Для подписи (без зашифровки) файла plaintext.txt:
```bash
    gpg2 -u testkey@nonexistent.domain --detach-sign plaintext.txt
    gpg2 -u testkey@nonexistent.domain -b plaintext.txt
```
После чего будет создан файл подписи *plaintext.txt.sig*. Для того, чтобы внедрить файл и подпись в один файл (**НЕ** будет зашифрован):
```bash
    gpg2 -a -u testkey -s plaintext.txt
```
Чтобы извлечь документ из такого файла:
```bash
    gpg2 --output plaintext.txt --decrypt plaintext.txt.asc
```
Для проверки подписи (в каталоге должен присутствовать оригинальный файл):
```bash
    gpg2 --verify plaintext.txt.sig 
```
### Редактирование ключей, смена пароля приватного ключа ###

Открыть ключ для редактирования (в интерактивном режиме) можно командой
```bash
    gpg2 --edit-key testkey@nonexistent.domain
```
В этом режиме список доступных команд можно посмотреть при помощи команды *help*. После изменения данных они не сохраняются сразу, для сохранения и выхода необходимо использовать команду *save*. Для выхода без применения изменений --- *quit*. 

Чтобы быстро сменить пароль приватного ключа, используйте
```bash
    gpg2 --passwd testkey@nonexistent.domain
```
### Удаление ключей ###

> Удаление ключей - операция БЕЗВОЗВРАТНАЯ

Если необходимо удалить чужой публичный ключ из вашей связки (для которого нет пары --- приватного ключа), используйте команду:
```bash
    gpg2 --delete-key testkey@nonexistent.domain
```
Если попытаться удалить таким образом пару ключей, получите ошибку. В таком случае надо сперва удалить приватный ключ:
```bash
    gpg2 gpg2 --delete-secret-key testkey@nonexistent.domain
```
После чего можно удалять публичный ключ командой выше.

На этом всё, для демонстрации возможностей GnuPG достаточно. Материалы взяты из *man gpg2* и из [этого блога][3]. [Ещё одна][4] хорошая шпаргалка на английском языке

[1]: https://www.gnupg.org/ "Официальный сайт GnuPG"
[2]: https://www.gnupg.org/documentation/manuals/gnupg/Unattended-GPG-key-generation.html "Пакетная генерация пары ключей"
[3]: http://blog.regolit.com/2013/03/06/understanding-gnupg "Более подробная шпаргалка по gpg"
[4]: http://irtfweb.ifa.hawaii.edu/~lockhart/gpg/gpg-cs.html "Шпаргалка по gpg на английском"